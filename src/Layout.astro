---
import "@styles/styles.scss";
import type { TemplateConfig } from "utils/configType";

const { backgroundGrid, seo, logo, theme, forceTheme, appStoreLink, name } =
  Astro.props as TemplateConfig;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImage = logo.startsWith("http") ? logo : new URL("/og-image.png", Astro.site).href;
---

<!doctype html>
<html lang="en" data-theme={theme}>
  <head>
    <!-- Global Metadata -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    {logo.startsWith("http") && <link rel="apple-touch-icon" href={logo} />}
    <meta name="generator" content={Astro.generator} />

    <!-- Preload critical fonts -->
    <link rel="preload" href="/fonts/Inter-Regular.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/Inter-Bold.woff2" as="font" type="font/woff2" crossorigin />

    <!-- Preload critical above-fold image (first screenshot) - responsive -->
    <link rel="preload" href="/screenshots/projects-list-mobile.webp" as="image" type="image/webp" media="(max-width: 768px)" />
    <link rel="preload" href="/screenshots/projects-list.webp" as="image" type="image/webp" media="(min-width: 769px)" />

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://umami.robert-jensen.dk" />
    <link rel="dns-prefetch" href="https://apps.apple.com" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Primary Meta Tags -->
    <title>{seo.title}</title>
    <meta name="title" content={seo.title} />
    <meta name="description" content={seo.description} />
    <meta name="keywords" content="event planner app, party planner app, wedding planner, guest list manager, event budget tracker, RSVP tracker, event planning app, party organizer, iOS event app, iPhone party planner, event timeline, vendor management, celebration planner, birthday party planner, event coordination, event management app, free event planner" />
    <meta name="author" content="Robert Jensen" />
    <meta name="robots" content="index, follow" />

    <!-- Apple App Store Smart Banner -->
    <meta name="apple-itunes-app" content="app-id=6755695151" />
    <meta name="apple-mobile-web-app-title" content="Event Stories" />

    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="qIt43wKbCVGfZYBrH1zV-3NRdMEtU0fo9qT-7NBC4n8" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={seo.title} />
    <meta property="og:description" content={seo.description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content={name} />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={seo.title} />
    <meta name="twitter:description" content={seo.description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- Structured Data - Software Application -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Event Stories: Party Planner",
      "operatingSystem": "iOS",
      "applicationCategory": "LifestyleApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "ratingCount": "1"
      },
      "description": seo.description,
      "url": canonicalURL.href,
      "downloadUrl": appStoreLink,
      "screenshot": new URL("/screenshots/projects-list.webp", Astro.site).href,
      "author": {
        "@type": "Person",
        "name": "Robert Jensen"
      }
    })} />

    <!-- Structured Data - FAQ -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Is Event Stories free to use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, it's free! We also offer a Premium Lifetime upgrade with more advanced features for serious event planners."
          }
        },
        {
          "@type": "Question",
          "name": "Does the app work offline?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Absolutely! Event Stories is designed to work fully offline so you can access your events, guest lists, and budgets even without internet access - perfect for venue visits."
          }
        },
        {
          "@type": "Question",
          "name": "Can I share events with others?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! With iCloud sync your events stay up to date across your devices. You can also export professional PDF reports to share with co-planners, vendors, or your event team."
          }
        },
        {
          "@type": "Question",
          "name": "How do I export reports?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Simply open your event, tap the export button, and choose PDF. Event Stories generates a professional report with your guest list, budget summary, vendor contacts, and schedule."
          }
        },
        {
          "@type": "Question",
          "name": "What devices are supported?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Event Stories is currently available for iPhone and requires iOS 17.0 or later. We're focused on delivering the best possible experience on iOS first."
          }
        }
      ]
    })} />

    <!-- Structured Data - Website -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": name,
      "url": Astro.site?.href
    })} />

    <script is:inline define:vars={{ forceTheme }}>
      function getPreferredColorScheme() {
        if (!window.matchMedia) {
          return;
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
      }
      const theme = localStorage.getItem("theme") ?? getPreferredColorScheme();
      if (theme === "dark" && !forceTheme)
        document.documentElement.setAttribute("data-theme", theme);
    </script>

    <!-- Umami Analytics -->
    <script defer src="https://umami.robert-jensen.dk/script.js" data-website-id="0df3d4bd-48ba-46d8-b04c-bfee9f848988"></script>
  </head>
  <body class="relative">
    {backgroundGrid && <div class="backgroundGrid" />}
    <slot />
  </body>
</html>
